<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„ë„ ë¶„ì„ ëŒ€ì‹œë³´ë“œ - YouTube Comment Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --accent-color: #D64545;
            --accent-color-rgb: 214, 69, 69;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.99)), url('https://cdn.pixabay.com/photo/2022/02/21/06/42/tablet-7025900_1280.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #ffffff;
        }
        
        .header {
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(15px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--accent-color);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            gap: 1.5rem; 
        }

        .home-button {
            color: #ffffff;
            background: #282828;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.2rem;
            border: 2px solid var(--accent-color);
            transition: background 0.2s;
        }
        
        .home-button:hover {
            background: rgba(var(--accent-color-rgb), 0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            color: #ffffff;
            margin: 0;
        }
        
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem 2rem;
        }

        .card {
            background: rgba(30, 30, 30, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .channel-profile {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .channel-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color);
        }

        .channel-info h2 {
            font-size: 1.8rem;
            color: #ffffff;
            font-weight: 600;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .stat-box {
            text-align: center;
            padding: 1.25rem;
            background: rgba(40, 40, 40, 0.9);
            border-radius: 10px;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .stat-box .value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #fff;
            line-height: 1.2;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        @media (max-width: 900px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .chart-box {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .chart-box h3 {
            font-size: 1.25rem;
            color: #ffffff;
            margin-bottom: 2.5rem;
            border-bottom: 2px solid rgba(var(--accent-color-rgb), 0.3);
            padding-bottom: 1.5rem;
            width: 100%;
            text-align: center;
        }

        .chart-box canvas {
            max-height: 100%;
            max-width: 100%;
            margin-bottom: 2.5rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 1rem;
            color: #fff;
        }

        .legend-color-box {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .video-info-list h3 {
            font-size: 1.4rem;
            color: #ffffff;
            margin-bottom: 1rem;
        }
        
        .video-box {
            background: rgba(50, 50, 50, 0.9);
            display: flex;
            gap: 1rem;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .video-thumbnail{
            width: 120px;
            height: auto;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .video-details {
            flex-grow: 1;
        }

        .video-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .video-box p {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .video-box .meta {
            font-size: 0.85rem;
            color: #ccc;
        }

        .video-box a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 600;
            display: block;
            margin-top: 0.5rem;
        }
        
        .keyword-cloud-container {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            margin-top: 0.1rem;
            justify-content: center;
            height: 100%;
            flex: 1;
        }

        .keyword-item {
            background: rgba(40, 40, 40, 0.9);
            padding: 1.5rem 2rem;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s, transform 0.2s;
        }

        .keyword-item:hover {
            background: rgba(50, 50, 50, 0.9);
            transform: translateX(5px);
        }

        .keyword-item .keyword-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #fff;
        }

        .keyword-item .keyword-count {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .keyword-item .keyword-count::after {
            content: "ì ";
            font-size: 0.9rem;
            color: #aaa;
            margin-left: 0.3rem;
        }

        .chartjs-tooltip {
            background: rgba(0, 0, 0, 0.7) !important;
            border-radius: 6px !important;
            color: white !important;
            padding: 8px !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5) !important;
        }

        .loading-screen {
            text-align: center;
            padding: 4rem 2rem;
        }

        .dashboard-container {
            display: none;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }   

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        } 

        .recent-videos-section {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        @media (max-width: 900px) {
            .recent-videos-section {
                grid-template-columns: 1fr;
            }
        }

        .average-stats-card {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .average-stats-card h3 {
            font-size: 1.4rem;
            color: #ffffff;
            margin-bottom: 1.5rem;
            text-align: center;
            border-bottom: 2px solid rgba(var(--accent-color-rgb), 0.3);
            padding-bottom: 1rem;
        }

        .avg-stats-grid {
            display: grid;
            gap: 0.1rem;
            flex: 1;
            align-content: space-evenly;
        }

        .avg-stat-item {
            background: rgba(40, 40, 40, 0.9);
            padding: 2rem 1.75rem;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            transition: background 0.2s, transform 0.2s;
        }

        .avg-stat-item:hover {
            background: rgba(50, 50, 50, 0.9);
            transform: scale(1.02);
        }

        .avg-stat-item .label {
            font-size: 1.1rem;
            color: #aaa;
            font-weight: 500;
            text-align: center;
        }

        .avg-stat-item .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffffff;
            line-height: 1;
        }

        .recent-videos-list h3 {
            font-size: 1.4rem;
            color: #ffffff;
            margin-bottom: 1rem;
        }

        .recent-video-item {
            background: rgba(50, 50, 50, 0.9);
            display: flex;
            gap: 1rem;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .recent-video-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }

        .recent-video-thumbnail {
            width: 120px;
            height: 67px;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .recent-video-details {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .recent-video-title {
            font-size: 0.95rem;
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 0.5rem;
            color: #fff;
        }

        .recent-video-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: #aaa;
            flex-wrap: wrap;
        }

        .recent-video-stats span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .recent-video-date {
            font-size: 0.8rem;
            color: #888;
            margin-top: 0.3rem;
        }

        .channel-profile-card {
            position: relative;
        }

        .youtube-channel-button {
            position: absolute;
            top: 2.5rem;
            right: 3.5rem;
            background: var(--accent-color);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.2s, transform 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .youtube-channel-button:hover {
            background: rgba(var(--accent-color-rgb), 0.8);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .youtube-channel-button::before {
            content: "â–¶";
            font-size: 1.1rem;
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="header-content">
            <a href="index.html" class="home-button">LDB</a>
            <h1>YouTube ì±„ë„ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
        </div>
    </header>
        <!-- ë¡œë”© í™”ë©´ -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <p class="loading-text">ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
    

    <div class="dashboard-container" id="dashboard-container">
        
        <!-- ì±„ë„ í”„ë¡œí•„ ë° ì£¼ìš” í†µê³„ -->
        <div class="card channel-profile-card">

            <a id="youtubeChannelLink" href="#" target="_blank" class="youtube-channel-button">
                ì±„ë„ ë³´ëŸ¬ê°€ê¸°
            </a>
            <div class="channel-profile">
                <img id="channelLogo" class="channel-logo" src="https://placehold.co/80x80/28a745/white?text=LOGO" alt="ì±„ë„ ë¡œê³ ">
                <div class="channel-info">
                    <h2 id="channelNameDisplay">ì±„ë„ ì´ë¦„ ë¡œë”© ì¤‘...</h2>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="label">ì´ êµ¬ë…ììˆ˜</div>
                    <div id="subscriberCount" class="value">0</div>
                </div>
                <div class="stat-box">
                    <div class="label">ì´ ì¡°íšŒìˆ˜</div>
                    <div id="viewCount" class="value">0</div>
                </div>
                <div class="stat-box">
                    <div class="label">ì´ ì˜ìƒ ìˆ˜</div>
                    <div id="videoCount" class="value">0</div>
                </div>
            </div>
        </div>

        <!-- ì°¨íŠ¸ ë° ì˜ìƒ ì •ë³´ -->
        <div class="content-grid">
            
            <!-- ì°¨íŠ¸ ì˜ì—­ -->
            <div class="chart-container">
                
                <!-- ëŒ“ê¸€ ê°ì • ë¶„ì„ ì°¨íŠ¸ -->
                <div class="card chart-box">
                    <h3>ëŒ“ê¸€ ê°ì • ë¶„ì„</h3>
                    <canvas id="emotionChart"></canvas>
                    <div id="emotionLegend">
                        <div class="legend-item">
                            <span class="legend-color-box" style="background-color: #28a745;"></span>
                            <span>ê¸ì •</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color-box" style="background-color: #dc3545;"></span>
                            <span>ë¶€ì •</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color-box" style="background-color: #6c757d;"></span>
                            <span>ì¤‘ë¦½</span>
                        </div>
                    </div>
                </div>

                <!-- í‚¤ì›Œë“œ í´ë¼ìš°ë“œ -->
                <div class="card">
                    <h3>ì¸ê¸° í‚¤ì›Œë“œ (ëŒ“ê¸€ ê¸°ë°˜)</h3>
                    <div id="keywordCloud" class="keyword-cloud-container">
                        <!-- í‚¤ì›Œë“œ íƒœê·¸ê°€ ì—¬ê¸°ì— ì‚½ì…ë©ë‹ˆë‹¤ -->
                    </div>
                </div>

            </div>

            <!-- ì˜ìƒ ì •ë³´ ì˜ì—­ -->
            <div class="video-info-list">
                <div class="card">
                    <h3>ìµœì‹  ì˜ìƒ</h3>
                    <div class="video-box" onclick="document.getElementById('recentVideoLink').click()">
                        <img id="recentVideoThumbnail" class="video-thumbnail" src="https://placehold.co/120x67/333/white?text=No+Img" alt="ìµœì‹  ì˜ìƒ ì¸ë„¤ì¼" onerror="this.src='https://placehold.co/120x67/333/white?text=No+Img'">
                        <div class="video-details">
                            <p id="recentVideoTitle">ìµœì‹  ì˜ìƒ ì œëª© ë¡œë”© ì¤‘...</p>
                            <div class="meta">ì¡°íšŒìˆ˜: <span id="recentVideoViews">0</span>íšŒ | ê²Œì‹œì¼: <span id="recentVideoDate">YYYY.MM.DD</span></div>
                            <a id="recentVideoLink" href="#" target="_blank">ì˜ìƒ ë¶„ì„í•˜ê¸° &rarr;</a>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>ìµœê·¼ ê°€ì¥ ì¸ê¸° ìˆëŠ” ì˜ìƒ</h3>
                    <div class="video-box" onclick="document.getElementById('mostViewedLink').click()">
                        <img id="mostViewedThumbnail" class="video-thumbnail" src="https://placehold.co/120x67/333/white?text=No+Img" alt="ì¸ê¸° ì˜ìƒ ì¸ë„¤ì¼" onerror="this.src='https://placehold.co/120x67/333/white?text=No+Img'">
                        <div class="video-details">
                            <p id="mostViewedTitle">ì¸ê¸° ì˜ìƒ ì œëª© ë¡œë”© ì¤‘...</p>
                            <div class="meta">ì¡°íšŒìˆ˜: <span id="mostViewedViews">0</span>íšŒ | ê²Œì‹œì¼: <span id="mostViewedDate">YYYY.MM.DD</span></div>
                            <a id="mostViewedLink" href="#" target="_blank">ì˜ìƒ ë¶„ì„í•˜ê¸° &rarr;</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="recent-videos-section">
            <!-- ì™¼ìª½: í‰ê·  í†µê³„ -->
            <div class="card average-stats-card">
                <h3>ìµœì‹  5ê°œ ì˜ìƒ í‰ê·  í†µê³„</h3>
                <div class="avg-stats-grid">
                    <div class="avg-stat-item">
                        <span class="label">í‰ê·  ì¡°íšŒìˆ˜</span>
                        <span id="avgViews" class="value">0</span>
                    </div>
                    <div class="avg-stat-item">
                        <span class="label">í‰ê·  ì¢‹ì•„ìš”</span>
                        <span id="avgLikes" class="value">0</span>
                    </div>
                    <div class="avg-stat-item">
                        <span class="label">í‰ê·  ëŒ“ê¸€</span>
                        <span id="avgComments" class="value">0</span>
                    </div>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ìµœì‹  ì˜ìƒ 5ê°œ ë¦¬ìŠ¤íŠ¸ -->
            <div class="card recent-videos-list">
                <h3>ìµœì‹  ì˜ìƒ 5ê°œ</h3>
                <div id="recentVideosList"></div>
            </div>
        </div>
    </div>

    <script>
        // Chart.js ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥í•  ë³€ìˆ˜
        let emotionChart = null;
        let analysisData = null;

        function formatNumber(num) {
            const number = typeof num === 'string' ? parseInt(num.replace(/,/g, ''), 10) : num;
            
            if (number < 10000) {
                return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }

            if (number >= 100000000) {
                const unit = number / 100000000;
                return unit.toFixed(1).replace(/\.0$/, '') + 'ì–µ';
            }
            if (number >= 10000) {
                const unit = number / 10000;
                return unit.toFixed(1).replace(/\.0$/, '') + 'ë§Œ';
            }
            
            return number.toString();
        }

        function updateDashboard() {
            let mostViewedVideo = [];
            let mostRecentVideo = [];

            try{
                //ìµœê·¼ ì˜ìƒì¤‘ ê°€ì¥ ì¸ê¸°ìˆëŠ” ì˜ìƒ ì°¾ê¸°
                if (analysisData.videoMetas && analysisData.videoMetas.length > 0) {
                    mostViewedVideo = analysisData.videoMetas.reduce((max, video) => {
                        return video.viewCount > max.viewCount ? video : max;
                    });
                    //ê°€ì¥ ìµœê·¼ ì˜ìƒ ì°¾ê¸°
                    mostRecentVideo = analysisData.videoMetas.reduce((latest, video) => {
                        return new Date(video.publishedAt) > new Date(latest.publishedAt) ? video : latest;
                    });
                }

                document.getElementById('channelNameDisplay').textContent = analysisData.channel.title;
                document.getElementById('channelLogo').src = analysisData.channel.thumbnails;
                
                document.getElementById('youtubeChannelLink').href = `https://www.youtube.com/channel/${analysisData.channel.id}`;
                
                document.getElementById('subscriberCount').textContent = formatNumber(analysisData.channel.subscriberCount);
                document.getElementById('viewCount').textContent = formatNumber(analysisData.channel.viewCount);
                
                document.getElementById('videoCount').textContent = analysisData.channel.videoCount;

                const recent = mostRecentVideo;
                document.getElementById('recentVideoThumbnail').src = recent.thumbnails;
                document.getElementById('recentVideoTitle').textContent = recent.title;
                document.getElementById('recentVideoViews').textContent = recent.viewCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                document.getElementById('recentVideoDate').textContent = new Date(recent.publishedAt).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' });
                document.getElementById('recentVideoLink').href = `watch_result.html?type=video&id=${recent.id}`;;
                document.getElementById('recentVideoLink').setAttribute('aria-label', `${recent.title} ì˜ìƒ ë¶„ì„`);


                //ì¸ê¸° ì˜ìƒ ì •ë³´ (mostViewedVideo ì‚¬ìš©)
                const mostViewed = mostViewedVideo;
                document.getElementById('mostViewedThumbnail').src = mostViewed.thumbnails;
                document.getElementById('mostViewedTitle').textContent = mostViewed.title;
                document.getElementById('mostViewedViews').textContent = mostViewed.viewCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                document.getElementById('mostViewedDate').textContent = new Date(mostViewed.publishedAt).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' });
                document.getElementById('mostViewedLink').href = `watch_result.html?type=video&id=${mostViewed.id}`;
                document.getElementById('mostViewedLink').setAttribute('aria-label', `${mostViewed.title} ì˜ìƒ ë¶„ì„`);


                
                createEmotionChart(analysisData);
                createKeywordCloud(analysisData);
                updateRecentVideosSection(analysisData);

                 // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê³  ì½˜í…ì¸  í‘œì‹œ
                document.getElementById('loadingScreen').style.display = 'none';
                document.querySelector('.dashboard-container').style.display = 'block';

            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                document.getElementById('loadingScreen').innerHTML = `
                    <p style="color: #dc3545; font-size: 1.2rem;">ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                    <p style="color: #888; margin-top: 1rem;">${error.message}</p>
                    <button onclick="window.location.href='index.html'" style="
                        margin-top: 2rem;
                        padding: 0.75rem 2rem;
                        background: #667eea;
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 1rem;
                    ">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                `;
            }

        }


        function createEmotionChart(data) {
            if (emotionChart) emotionChart.destroy(); // ê¸°ì¡´ ì°¨íŠ¸ íŒŒê´´

            const ctx = document.getElementById('emotionChart').getContext('2d');

            const total = data.POSITIVE + data.NEGATIVE + data.NEUTRAL;
            const positivePercent = ((data.POSITIVE / total) * 100).toFixed(1);
            const negativePercent = ((data.NEGATIVE / total) * 100).toFixed(1);
            const neutralPercent = ((data.NEUTRAL / total) * 100).toFixed(1);

            emotionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ê¸ì •', 'ë¶€ì •', 'ì¤‘ë¦½'],
                    datasets: [{
                        data: [positivePercent, negativePercent, neutralPercent],
                        backgroundColor: ['#28a745', '#dc3545', '#6c757d'],
                        borderWidth: 2,
                        borderColor: '#333'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }


        function createKeywordCloud(data) {
            const container = document.getElementById('keywordCloud');
            container.innerHTML = '';
            
            const keywords = data.topKeywordGlobal;
            
            if (keywords && keywords.length > 0) {
                keywords.forEach((item, index) => {
                    const keywordDiv = document.createElement('div');
                    keywordDiv.className = 'keyword-item';
                    
                    keywordDiv.innerHTML = `
                        <span class="keyword-name">${index + 1}. ${item.keyword}</span>
                        <span class="keyword-count">${item.count}</span>
                    `;
                    
                    container.appendChild(keywordDiv);
                });
            } else {
                container.textContent = 'ë¶„ì„ëœ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤.';
                container.style.color = '#ccc';
            }
        }

        function updateRecentVideosSection(data) {
            const videos = data.videoMetas;
            
            // í‰ê·  í†µê³„ ê³„ì‚°
            let totalViews = 0;
            let totalLikes = 0;
            let totalComments = 0;
            
            videos.forEach(video => {
                totalViews += video.viewCount;
                totalLikes += video.likeCount;
                totalComments += video.commentCount;
            });
            
            const avgViews = Math.round(totalViews / videos.length);
            const avgLikes = Math.round(totalLikes / videos.length);
            const avgComments = Math.round(totalComments / videos.length);
            
            document.getElementById('avgViews').textContent = formatNumber(avgViews);
            document.getElementById('avgLikes').textContent = formatNumber(avgLikes);
            document.getElementById('avgComments').textContent = formatNumber(avgComments);
            
            // ì˜ìƒ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            const listContainer = document.getElementById('recentVideosList');
            listContainer.innerHTML = '';
            
            videos.forEach(video => {
                const videoItem = document.createElement('div');
                videoItem.className = 'recent-video-item';
                videoItem.onclick = () => {
                    window.open(`watch_result.html?type=video&id=${video.id}`, '_blank');
                };
                
                videoItem.innerHTML = `
                    <img src="${video.thumbnails}" alt="${video.title}" class="recent-video-thumbnail" onerror="this.src='https://placehold.co/120x67/333/white?text=No+Img'">
                    <div class="recent-video-details">
                        <div class="recent-video-title">${video.title}</div>
                        <div class="recent-video-stats">
                            <span>ğŸ‘ ${formatNumber(video.viewCount)}</span>
                            <span>ğŸ‘ ${formatNumber(video.likeCount)}</span>
                            <span>ğŸ’¬ ${formatNumber(video.commentCount)}</span>
                        </div>
                        <div class="recent-video-date">${new Date(video.publishedAt).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' })}</div>
                    </div>
                `;
                
                listContainer.appendChild(videoItem);
            });
        }

                // í˜ì´ì§€ ë¡œë“œ ì‹œ URLì—ì„œ íŒŒë¼ë¯¸í„° ì¶”ì¶œ í›„ ë°±ì—”ë“œ ìš”ì²­
        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            const type = params.get('type');
            const id = params.get('id');
            let isPolling = true;
            
            if (!type || !id) {
                alert('ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.');
                window.location.href = 'index.html';
                return;
            }
            
            const pollInterval = 2000;
            const maxAttempts = 150;
            let attempts = 0;
            
            async function checkAnalysisStatus() {
                if (!isPolling) return;
                
                try {
                    attempts++;
                    const response = await fetch(`http://localhost:8080/${type}/${id}`);
                    
                    if (response.ok) {
                        analysisData = await response.json();
                        isPolling = false;
                        updateDashboard();
                        return true;
                    } else if (response.status === 404 || response.status === 202) {
                        if (attempts >= maxAttempts) {
                            isPolling = false;
                            throw new Error('ë¶„ì„ ì‹œê°„ì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                        }
                        setTimeout(checkAnalysisStatus, pollInterval);
                        return false;
                    } else {
                        isPolling = false;
                        throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                    }
                    
                } catch (error) {
                    isPolling = false;
                    console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                    document.getElementById('loadingScreen').innerHTML = `
                        <p style="color: #dc3545; font-size: 1.2rem;">ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
                        <p style="color: #888; margin-top: 1rem;">${error.message}</p>
                        <button onclick="window.location.href='index.html'" style="
                            margin-top: 2rem;
                            padding: 0.75rem 2rem;
                            background: var(--accent-color);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 1rem;
                        ">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                    `;
                }
            }
            
            checkAnalysisStatus();
        });

    </script>
</body>
</html>
