<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채널 분석 대시보드 - YouTube Comment Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /*
         * 전반적인 스타일
         */
        /* 새로운 강조색: #D64545 */
        :root {
            --accent-color: #D64545;
            --accent-color-rgb: 214, 69, 69;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            /* 배경 이미지와 어두운 오버레이 */
            background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.99)), url('https://cdn.pixabay.com/photo/2022/02/21/06/42/tablet-7025900_1280.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #ffffff;
        }
        
        /* 헤더 스타일 */
        .header {
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(15px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--accent-color); /* 색상 변경 */
        }
        
        .header-content {
            display: flex;
            align-items: center;
            gap: 1.5rem; 
        }

        .home-button {
            color: #ffffff;
            background: #282828;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.2rem;
            border: 2px solid var(--accent-color); /* 색상 변경 */
            transition: background 0.2s;
        }
        
        .home-button:hover {
            background: rgba(var(--accent-color-rgb), 0.1); /* 색상 변경 */
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            color: #ffffff; /* 색상 변경 */
            margin: 0;
        }
        
        /* 대시보드 레이아웃 */
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem 2rem;
        }

        /* 공통 카드 스타일 */
        .card {
            background: rgba(30, 30, 30, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 채널 프로필 섹션 */
        .channel-profile {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .channel-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color); /* 색상 변경 */
        }

        .channel-info h2 {
            font-size: 1.8rem;
            color: #ffffff; /* 색상 변경 */
            font-weight: 600;
        }
        
        /* 주요 통계 그리드 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .stat-box {
            text-align: center;
            padding: 1.25rem;
            background: rgba(40, 40, 40, 0.9);
            border-radius: 10px;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .stat-box .value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #fff;
            line-height: 1.2;
        }

        /* 차트 및 영상 정보 컨테이너 */
        .content-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr; /* 차트 2/3, 영상정보 1/3 */
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        @media (max-width: 900px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 차트 컨테이너 */
        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .chart-box {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .chart-box h3 {
            font-size: 1.25rem;
            color: #ffffff; /* 색상 변경 */
            margin-bottom: 2.5rem;
            border-bottom: 2px solid rgba(var(--accent-color-rgb), 0.3); /* 색상 변경 */
            padding-bottom: 1.5rem;
            width: 100%;
            text-align: center;
        }

        .chart-box canvas {
            max-height: 100%;
            max-width: 100%;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 1rem;
            color: #fff;
        }

        .legend-color-box {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        /* 영상 정보 리스트 */
        .video-info-list h3 {
            font-size: 1.4rem;
            color: #ffffff; /* 색상 변경 */
            margin-bottom: 1rem;
        }
        
        .video-box {
            background: rgba(50, 50, 50, 0.9);
            display: flex;
            gap: 1rem;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .video-thumbnail{
            width: 120px;
            height: auto;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0; /* 내용이 줄어들어도 썸네일 크기 유지 */
        }

        /* 영상 상세 정보 컨테이너 */
        .video-details {
            flex-grow: 1;
        }

        .video-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .video-box p {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .video-box .meta {
            font-size: 0.85rem;
            color: #ccc;
        }

        .video-box a {
            color: var(--accent-color); /* 색상 변경 */
            text-decoration: none;
            font-weight: 600;
            display: block;
            margin-top: 0.5rem;
        }
        
        /* 키워드 클라우드 스타일 */
        .keyword-cloud-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: center;
            align-items: center;
            min-height: 100px;
        }

        .keyword-tag {
            background: var(--accent-color); /* 색상 변경 */
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Chart.js 툴팁 스타일 재정의 */
        .chartjs-tooltip {
            background: rgba(0, 0, 0, 0.7) !important;
            border-radius: 6px !important;
            color: white !important;
            padding: 8px !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5) !important;
        }

        .loading-screen {
            text-align: center;
            padding: 4rem 2rem;
        }

        .dashboard-container {
            display: none;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }   

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        } 
    </style>
</head>
<body>

    <header class="header">
        <div class="header-content">
            <a href="index.html" class="home-button">LDB</a>
            <h1>YouTube 채널 분석 대시보드</h1>
        </div>
    </header>
        <!-- 로딩 화면 -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <p class="loading-text">분석 결과를 불러오는 중...</p>
    </div>
    

    <div class="dashboard-container" id="dashboard-container">
        
        <!-- 채널 프로필 및 주요 통계 -->
        <div class="card channel-profile-card">
            <div class="channel-profile">
                <img id="channelLogo" class="channel-logo" src="https://placehold.co/80x80/28a745/white?text=LOGO" alt="채널 로고">
                <div class="channel-info">
                    <h2 id="channelNameDisplay">채널 이름 로딩 중...</h2>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="label">총 구독자수</div>
                    <div id="subscriberCount" class="value">0</div>
                </div>
                <div class="stat-box">
                    <div class="label">총 조회수</div>
                    <div id="viewCount" class="value">0</div>
                </div>
                <div class="stat-box">
                    <div class="label">총 영상 수</div>
                    <div id="videoCount" class="value">0</div>
                </div>
            </div>
        </div>

        <!-- 차트 및 영상 정보 -->
        <div class="content-grid">
            
            <!-- 차트 영역 -->
            <div class="chart-container">
                
                <!-- 댓글 감정 분석 차트 -->
                <div class="card chart-box">
                    <h3>댓글 감정 분석</h3>
                    <canvas id="emotionChart"></canvas>
                    <div id="emotionLegend">
                        <div class="legend-item">
                            <span class="legend-color-box" style="background-color: #28a745;"></span>
                            <span>긍정</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color-box" style="background-color: #dc3545;"></span>
                            <span>부정</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color-box" style="background-color: #6c757d;"></span>
                            <span>중립</span>
                        </div>
                    </div>
                </div>

                <!-- 키워드 클라우드 -->
                <div class="card">
                    <h3>인기 키워드 (댓글 기반)</h3>
                    <div id="keywordCloud" class="keyword-cloud-container">
                        <!-- 키워드 태그가 여기에 삽입됩니다 -->
                    </div>
                </div>

            </div>

            <!-- 영상 정보 영역 -->
            <div class="video-info-list">
                <div class="card">
                    <h3>최신 영상</h3>
                    <div class="video-box" onclick="document.getElementById('recentVideoLink').click()">
                        <img id="recentVideoThumbnail" class="video-thumbnail" src="https://placehold.co/120x67/333/white?text=No+Img" alt="최신 영상 썸네일" onerror="this.src='https://placehold.co/120x67/333/white?text=No+Img'">
                        <div class="video-details">
                            <p id="recentVideoTitle">최신 영상 제목 로딩 중...</p>
                            <div class="meta">조회수: <span id="recentVideoViews">0</span>회 | 게시일: <span id="recentVideoDate">YYYY.MM.DD</span></div>
                            <a id="recentVideoLink" href="#" target="_blank">영상 분석하기 &rarr;</a>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>최근 가장 인기 있는 영상</h3>
                    <div class="video-box" onclick="document.getElementById('mostViewedLink').click()">
                        <img id="mostViewedThumbnail" class="video-thumbnail" src="https://placehold.co/120x67/333/white?text=No+Img" alt="인기 영상 썸네일" onerror="this.src='https://placehold.co/120x67/333/white?text=No+Img'">
                        <div class="video-details">
                            <p id="mostViewedTitle">인기 영상 제목 로딩 중...</p>
                            <div class="meta">조회수: <span id="mostViewedViews">0</span>회 | 게시일: <span id="mostViewedDate">YYYY.MM.DD</span></div>
                            <a id="mostViewedLink" href="#" target="_blank">영상 분석하기 &rarr;</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <script>
        // Chart.js 인스턴스를 저장할 변수
        let emotionChart = null;
        let analysisData = null;

        function formatNumber(num) {
            const number = typeof num === 'string' ? parseInt(num.replace(/,/g, ''), 10) : num;
            
            if (number < 10000) {
                return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }

            if (number >= 100000000) {
                const unit = number / 100000000;
                return unit.toFixed(1).replace(/\.0$/, '') + '억';
            }
            if (number >= 10000) {
                const unit = number / 10000;
                return unit.toFixed(1).replace(/\.0$/, '') + '만';
            }
            
            return number.toString();
        }

        function updateDashboard() {

            try{
                //채널 정보 (parsedMeta 사용)
                document.getElementById('channelNameDisplay').textContent = analysisData.parsedMeta.title;
                document.getElementById('channelLogo').src = analysisData.parsedMeta.thumbnail;
                
                const stats = analysisData.channelJson.items[0].statistics;
                
                document.getElementById('subscriberCount').textContent = formatNumber(stats.subscriberCount);
                document.getElementById('viewCount').textContent = formatNumber(stats.viewCount);
                
                document.getElementById('videoCount').textContent = analysisData.playlistJson.pageInfo.totalResults.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

                const recent = analysisData.mostRecentVideo;
                document.getElementById('recentVideoThumbnail').src = recent.thumbnail;
                document.getElementById('recentVideoTitle').textContent = recent.title;
                document.getElementById('recentVideoViews').textContent = recent.viewCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                document.getElementById('recentVideoDate').textContent = new Date(recent.publishedAt).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' });
                document.getElementById('recentVideoLink').href = `watch_result.html?type=video&id=${recent.videoId}`;;
                document.getElementById('recentVideoLink').setAttribute('aria-label', `${recent.title} 영상 분석`);


                //인기 영상 정보 (mostViewedVideo 사용)
                const mostViewed = analysisData.mostViewedVideo;
                document.getElementById('mostViewedThumbnail').src = mostViewed.thumbnail;
                document.getElementById('mostViewedTitle').textContent = mostViewed.title;
                document.getElementById('mostViewedViews').textContent = mostViewed.viewCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                document.getElementById('mostViewedDate').textContent = new Date(mostViewed.publishedAt).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' });
                document.getElementById('mostViewedLink').href = `watch_result.html?type=video&id=${mostViewed.videoId}`;
                document.getElementById('mostViewedLink').setAttribute('aria-label', `${mostViewed.title} 영상 분석`);


                
                createEmotionChart(analysisData);
                createKeywordCloud(analysisData);

                 // 로딩 화면 숨기고 콘텐츠 표시
                document.getElementById('loadingScreen').style.display = 'none';
                document.querySelector('.dashboard-container').style.display = 'block';

            } catch (error) {
                console.error('데이터 로드 중 오류:', error);
                document.getElementById('loadingScreen').innerHTML = `
                    <p style="color: #dc3545; font-size: 1.2rem;">데이터 처리 중 오류가 발생했습니다.</p>
                    <p style="color: #888; margin-top: 1rem;">${error.message}</p>
                    <button onclick="window.location.href='index.html'" style="
                        margin-top: 2rem;
                        padding: 0.75rem 2rem;
                        background: #667eea;
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 1rem;
                    ">메인으로 돌아가기</button>
                `;
            }

        }


        function createEmotionChart(data) {
            if (emotionChart) emotionChart.destroy(); // 기존 차트 파괴

            const ctx = document.getElementById('emotionChart').getContext('2d');
            const emotions = data.sentimentSummaryTotal;

            emotionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['긍정', '부정', '중립'],
                    datasets: [{
                        data: [emotions.POSITIVE, emotions.NEGATIVE, emotions.NEUTRAL],
                        backgroundColor: ['#28a745', '#dc3545', '#6c757d'],
                        borderWidth: 2,
                        borderColor: '#333'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false // 범례는 별도로 HTML로 표시
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }


        function createKeywordCloud(data) {
            const container = document.getElementById('keywordCloud');
            container.innerHTML = ''; // 기존 내용 초기화
            
            const keywords = data.topKeywordsAcross5; // analysisData에 있다고 가정
            
            if (keywords && keywords.length > 0) {
                keywords.forEach(item  => {
                    const tag = document.createElement('span');
                    tag.className = 'keyword-tag';
                    tag.textContent = tag.textContent = `${item.keyword} (${item.count})`;
                    container.appendChild(tag);
                });
            } else {
                container.textContent = '분석된 키워드가 없습니다.';
                container.style.color = '#ccc';
            }
        }
                // 페이지 로드 시 URL에서 파라미터 추출 후 백엔드 요청
        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            const type = params.get('type');
            const id = params.get('id');
            
            if (!type || !id) {
                alert('잘못된 접근입니다.');
                window.location.href = 'index(10_28).html';
                return;
            }
            
            // 폴링: 주기적으로 서버에 데이터 요청
            const pollInterval = 2000; // 2초마다 체크
            const maxAttempts = 150; // 최대 5분 (2초 * 150 = 300초)
            let attempts = 0;
            let isPolling = true; // 폴링 상태 추적
            
            async function checkAnalysisStatus() {
                if (!isPolling) return; // 이미 완료되었으면 중단


                try {
                    attempts++;
                    const response = await fetch(`http://localhost:8080/${type}/${id}`);
                    
                    if (response.ok) {
                        analysisData = await response.json();
                        isPolling = false; // 폴링 중단
                        updateDashboard();
                        return true; // 성공
                    } else if (response.status === 404 || response.status === 202) {
                        // 404 또는 202: 아직 분석 중
                        if (attempts >= maxAttempts) {
                            isPolling = false;
                            throw new Error('분석 시간이 너무 오래 걸립니다. 잠시 후 다시 시도해주세요.');
                        }
                        // 계속 폴링
                        setTimeout(checkAnalysisStatus, pollInterval);
                        return false;
                    } else {
                        isPolling = false;
                        throw new Error('데이터를 불러올 수 없습니다.');
                    }
                    
                } catch (error) {
                    isPolling = false;
                    console.error('데이터 로드 오류:', error);
                    document.getElementById('loadingScreen').innerHTML = `
                        <p style="color: #dc3545; font-size: 1.2rem;">분석 결과를 불러오는데 실패했습니다.</p>
                        <p style="color: #888; margin-top: 1rem;">${error.message}</p>
                        <button onclick="window.location.href='index.html'" style="
                            margin-top: 2rem;
                            padding: 0.75rem 2rem;
                            background: var(--accent-color);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 1rem;
                        ">메인으로 돌아가기</button>
                    `;
                }
            }
            
            // 첫 요청 시작
            checkAnalysisStatus();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채널 분석 대시보드 - YouTube Comment Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /*
         * 전반적인 스타일
         */
        /* 새로운 강조색: #D64545 */
        :root {
            --accent-color: #D64545;
            --accent-color-rgb: 214, 69, 69;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            /* 배경 이미지와 어두운 오버레이 */
            background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.99)), url('https://cdn.pixabay.com/photo/2022/02/21/06/42/tablet-7025900_1280.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #ffffff;
        }
        
        /* 헤더 스타일 */
        .header {
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(15px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--accent-color); /* 색상 변경 */
        }
        
        .header-content {
            display: flex;
            align-items: center;
            gap: 1.5rem; 
        }

        .home-button {
            color: #ffffff;
            background: #282828;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.2rem;
            border: 2px solid var(--accent-color); /* 색상 변경 */
            transition: background 0.2s;
        }
        
        .home-button:hover {
            background: rgba(var(--accent-color-rgb), 0.1); /* 색상 변경 */
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            color: #ffffff; /* 색상 변경 */
            margin: 0;
        }
        
        /* 대시보드 레이아웃 */
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem 2rem;
        }

        /* 공통 카드 스타일 */
        .card {
            background: rgba(30, 30, 30, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 채널 프로필 섹션 */
        .channel-profile {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .channel-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color); /* 색상 변경 */
        }

        .channel-info h2 {
            font-size: 1.8rem;
            color: #ffffff; /* 색상 변경 */
            font-weight: 600;
        }
        
        /* 주요 통계 그리드 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .stat-box {
            text-align: center;
            padding: 1.25rem;
            background: rgba(40, 40, 40, 0.9);
            border-radius: 10px;
        }

        .stat-box .label {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .stat-box .value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #fff;
            line-height: 1.2;
        }

        /* 차트 및 영상 정보 컨테이너 */
        .content-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr; /* 차트 2/3, 영상정보 1/3 */
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        @media (max-width: 900px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 차트 컨테이너 */
        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .chart-box {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .chart-box h3 {
            font-size: 1.25rem;
            color: #ffffff; /* 색상 변경 */
            margin-bottom: 2.5rem;
            border-bottom: 2px solid rgba(var(--accent-color-rgb), 0.3); /* 색상 변경 */
            padding-bottom: 1.5rem;
            width: 100%;
            text-align: center;
        }

        .chart-box canvas {
            max-height: 100%;
            max-width: 100%;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 1rem;
            color: #fff;
        }

        .legend-color-box {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        /* 영상 정보 리스트 */
        .video-info-list h3 {
            font-size: 1.4rem;
            color: #ffffff; /* 색상 변경 */
            margin-bottom: 1rem;
        }
        
        .video-box {
            background: rgba(50, 50, 50, 0.9);
            display: flex;
            gap: 1rem;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .video-thumbnail{
            width: 120px;
            height: auto;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0; /* 내용이 줄어들어도 썸네일 크기 유지 */
        }

        /* 영상 상세 정보 컨테이너 */
        .video-details {
            flex-grow: 1;
        }

        .video-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .video-box p {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .video-box .meta {
            font-size: 0.85rem;
            color: #ccc;
        }

        .video-box a {
            color: var(--accent-color); /* 색상 변경 */
            text-decoration: none;
            font-weight: 600;
            display: block;
            margin-top: 0.5rem;
        }
        
        /* 키워드 클라우드 스타일 */
        .keyword-cloud-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: center;
            align-items: center;
            min-height: 100px;
        }

        .keyword-tag {
            background: var(--accent-color); /* 색상 변경 */
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Chart.js 툴팁 스타일 재정의 */
        .chartjs-tooltip {
            background: rgba(0, 0, 0, 0.7) !important;
            border-radius: 6px !important;
            color: white !important;
            padding: 8px !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5) !important;
        }

        .loading-screen {
            text-align: center;
            padding: 4rem 2rem;
        }

        .dashboard-container {
            display: none;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }   

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        } 
    </style>
</head>
<body>

    <header class="header">
        <div class="header-content">
            <a href="index(10_28).html" class="home-button">LDB</a>
            <h1>YouTube 채널 분석 대시보드</h1>
        </div>
    </header>
        <!-- 로딩 화면 -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <p class="loading-text">분석 결과를 불러오는 중...</p>
    </div>
    

    <div class="dashboard-container" id="dashboard-container">
        
        <!-- 채널 프로필 및 주요 통계 -->
        <div class="card channel-profile-card">
            <div class="channel-profile">
                <img id="channelLogo" class="channel-logo" src="https://placehold.co/80x80/28a745/white?text=LOGO" alt="채널 로고">
                <div class="channel-info">
                    <h2 id="channelNameDisplay">채널 이름 로딩 중...</h2>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="label">총 구독자수</div>
                    <div id="subscriberCount" class="value">0</div>
                </div>
                <div class="stat-box">
                    <div class="label">총 조회수</div>
                    <div id="viewCount" class="value">0</div>
                </div>
                <div class="stat-box">
                    <div class="label">총 영상 수</div>
                    <div id="videoCount" class="value">0</div>
                </div>
            </div>
        </div>

        <!-- 차트 및 영상 정보 -->
        <div class="content-grid">
            
            <!-- 차트 영역 -->
            <div class="chart-container">
                
                <!-- 댓글 감정 분석 차트 -->
                <div class="card chart-box">
                    <h3>댓글 감정 분석</h3>
                    <canvas id="emotionChart"></canvas>
                    <div id="emotionLegend">
                        <div class="legend-item">
                            <span class="legend-color-box" style="background-color: #28a745;"></span>
                            <span>긍정</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color-box" style="background-color: #dc3545;"></span>
                            <span>부정</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color-box" style="background-color: #6c757d;"></span>
                            <span>중립</span>
                        </div>
                    </div>
                </div>

                <!-- 키워드 클라우드 -->
                <div class="card">
                    <h3>인기 키워드 (댓글 기반)</h3>
                    <div id="keywordCloud" class="keyword-cloud-container">
                        <!-- 키워드 태그가 여기에 삽입됩니다 -->
                    </div>
                </div>

            </div>

            <!-- 영상 정보 영역 -->
            <div class="video-info-list">
                <div class="card">
                    <h3>최신 영상</h3>
                    <div class="video-box" onclick="document.getElementById('recentVideoLink').click()">
                        <img id="recentVideoThumbnail" class="video-thumbnail" src="https://placehold.co/120x67/333/white?text=No+Img" alt="최신 영상 썸네일" onerror="this.src='https://placehold.co/120x67/333/white?text=No+Img'">
                        <div class="video-details">
                            <p id="recentVideoTitle">최신 영상 제목 로딩 중...</p>
                            <div class="meta">조회수: <span id="recentVideoViews">0</span>회 | 게시일: <span id="recentVideoDate">YYYY.MM.DD</span></div>
                            <a id="recentVideoLink" href="#" target="_blank">영상 분석하기 &rarr;</a>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>최근 가장 인기 있는 영상</h3>
                    <div class="video-box" onclick="document.getElementById('mostViewedLink').click()">
                        <img id="mostViewedThumbnail" class="video-thumbnail" src="https://placehold.co/120x67/333/white?text=No+Img" alt="인기 영상 썸네일" onerror="this.src='https://placehold.co/120x67/333/white?text=No+Img'">
                        <div class="video-details">
                            <p id="mostViewedTitle">인기 영상 제목 로딩 중...</p>
                            <div class="meta">조회수: <span id="mostViewedViews">0</span>회 | 게시일: <span id="mostViewedDate">YYYY.MM.DD</span></div>
                            <a id="mostViewedLink" href="#" target="_blank">영상 분석하기 &rarr;</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <script>
        // Chart.js 인스턴스를 저장할 변수
        let emotionChart = null;
        let analysisData = null;

        function formatNumber(num) {
            const number = typeof num === 'string' ? parseInt(num.replace(/,/g, ''), 10) : num;
            
            if (number < 10000) {
                return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }

            if (number >= 100000000) {
                const unit = number / 100000000;
                return unit.toFixed(1).replace(/\.0$/, '') + '억';
            }
            if (number >= 10000) {
                const unit = number / 10000;
                return unit.toFixed(1).replace(/\.0$/, '') + '만';
            }
            
            return number.toString();
        }

        function updateDashboard() {

            try{
                //채널 정보 (parsedMeta 사용)
                document.getElementById('channelNameDisplay').textContent = analysisData.parsedMeta.title;
                document.getElementById('channelLogo').src = analysisData.parsedMeta.thumbnail;
                
                const stats = analysisData.channelJson.items[0].statistics;
                
                document.getElementById('subscriberCount').textContent = formatNumber(stats.subscriberCount);
                document.getElementById('viewCount').textContent = formatNumber(stats.viewCount);
                
                document.getElementById('videoCount').textContent = analysisData.playlistJson.pageInfo.totalResults.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

                const recent = analysisData.mostRecentVideo;
                document.getElementById('recentVideoThumbnail').src = recent.thumbnail;
                document.getElementById('recentVideoTitle').textContent = recent.title;
                document.getElementById('recentVideoViews').textContent = recent.viewCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                document.getElementById('recentVideoDate').textContent = new Date(recent.publishedAt).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' });
                document.getElementById('recentVideoLink').href = `watch_result_page(10_27).html?type=video&id=${recent.videoId}`;;
                document.getElementById('recentVideoLink').setAttribute('aria-label', `${recent.title} 영상 분석`);


                //인기 영상 정보 (mostViewedVideo 사용)
                const mostViewed = analysisData.mostViewedVideo;
                document.getElementById('mostViewedThumbnail').src = mostViewed.thumbnail;
                document.getElementById('mostViewedTitle').textContent = mostViewed.title;
                document.getElementById('mostViewedViews').textContent = mostViewed.viewCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                document.getElementById('mostViewedDate').textContent = new Date(mostViewed.publishedAt).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' });
                document.getElementById('mostViewedLink').href = `watch_result_page(10_27).html?type=video&id=${mostViewed.videoId}`;
                document.getElementById('mostViewedLink').setAttribute('aria-label', `${mostViewed.title} 영상 분석`);


                
                createEmotionChart(analysisData);
                createKeywordCloud(analysisData);

                 // 로딩 화면 숨기고 콘텐츠 표시
                document.getElementById('loadingScreen').style.display = 'none';
                document.querySelector('.dashboard-container').style.display = 'block';

            } catch (error) {
                console.error('데이터 로드 중 오류:', error);
                document.getElementById('loadingScreen').innerHTML = `
                    <p style="color: #dc3545; font-size: 1.2rem;">데이터 처리 중 오류가 발생했습니다.</p>
                    <p style="color: #888; margin-top: 1rem;">${error.message}</p>
                    <button onclick="window.location.href='/'" style="
                        margin-top: 2rem;
                        padding: 0.75rem 2rem;
                        background: #667eea;
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 1rem;
                    ">메인으로 돌아가기</button>
                `;
            }

        }


        function createEmotionChart(data) {
            if (emotionChart) emotionChart.destroy(); // 기존 차트 파괴

            const ctx = document.getElementById('emotionChart').getContext('2d');
            const emotions = data.sentimentSummaryTotal;

            emotionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['긍정', '부정', '중립'],
                    datasets: [{
                        data: [emotions.POSITIVE, emotions.NEGATIVE, emotions.NEUTRAL],
                        backgroundColor: ['#28a745', '#dc3545', '#6c757d'],
                        borderWidth: 2,
                        borderColor: '#333'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false // 범례는 별도로 HTML로 표시
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }


        function createKeywordCloud(data) {
            const container = document.getElementById('keywordCloud');
            container.innerHTML = ''; // 기존 내용 초기화
            
            const keywords = data.topKeywordsAcross5; // analysisData에 있다고 가정
            
            if (keywords && keywords.length > 0) {
                keywords.forEach(item  => {
                    const tag = document.createElement('span');
                    tag.className = 'keyword-tag';
                    tag.textContent = tag.textContent = `${item.keyword} (${item.count})`;
                    container.appendChild(tag);
                });
            } else {
                container.textContent = '분석된 키워드가 없습니다.';
                container.style.color = '#ccc';
            }
        }
                // 페이지 로드 시 URL에서 파라미터 추출 후 백엔드 요청
        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            const type = params.get('type');
            const id = params.get('id');
            
            if (!type || !id) {
                alert('잘못된 접근입니다.');
                window.location.href = 'index(10_28).html';
                return;
            }
            
            // 폴링: 주기적으로 서버에 데이터 요청
            const pollInterval = 2000; // 2초마다 체크
            const maxAttempts = 150; // 최대 5분 (2초 * 150 = 300초)
            let attempts = 0;
            let isPolling = true; // 폴링 상태 추적
            
            async function checkAnalysisStatus() {
                if (!isPolling) return; // 이미 완료되었으면 중단


                try {
                    attempts++;
                    const response = await fetch(`http://localhost:8080/${type}/${id}`);
                    
                    if (response.ok) {
                        analysisData = await response.json();
                        isPolling = false; // 폴링 중단
                        updateDashboard();
                        return true; // 성공
                    } else if (response.status === 404 || response.status === 202) {
                        // 404 또는 202: 아직 분석 중
                        if (attempts >= maxAttempts) {
                            isPolling = false;
                            throw new Error('분석 시간이 너무 오래 걸립니다. 잠시 후 다시 시도해주세요.');
                        }
                        // 계속 폴링
                        setTimeout(checkAnalysisStatus, pollInterval);
                        return false;
                    } else {
                        isPolling = false;
                        throw new Error('데이터를 불러올 수 없습니다.');
                    }
                    
                } catch (error) {
                    isPolling = false;
                    console.error('데이터 로드 오류:', error);
                    document.getElementById('loadingScreen').innerHTML = `
                        <p style="color: #dc3545; font-size: 1.2rem;">분석 결과를 불러오는데 실패했습니다.</p>
                        <p style="color: #888; margin-top: 1rem;">${error.message}</p>
                        <button onclick="window.location.href='index(10_28).html'" style="
                            margin-top: 2rem;
                            padding: 0.75rem 2rem;
                            background: var(--accent-color);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 1rem;
                        ">메인으로 돌아가기</button>
                    `;
                }
            }
            
            // 첫 요청 시작
            checkAnalysisStatus();
        });
    </script>
</body>
</html>
